{
  "name": "Workflow C - DonnÃ©es astronomiques",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// GÃ©nÃ©rer les timestamps pour les requÃªtes\nconst now = new Date();\nconst parisTime = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/Paris' }));\n\n// Format ISO avec timezone\nconst currentTimeISO = now.toISOString();\nconst currentDate = parisTime.toISOString().split('T')[0];\nconst currentHour = parisTime.getHours();\n\nreturn [{\n  json: {\n    currentTime: currentTimeISO,\n    currentDate: currentDate,\n    currentHour: currentHour\n  }\n}];"
      },
      "id": "4afbeaff-e626-4dd7-8d65-71fba6e3eabb",
      "name": "PrÃ©paration Date/Heure",
      "type": "n8n-nodes-base.code",
      "position": [
        464,
        400
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tVfyjzJ6iOLe8WXT",
          "mode": "list",
          "cachedResultUrl": "/workflow/tVfyjzJ6iOLe8WXT",
          "cachedResultName": "[SUB] Sunrise-Sunset - DonnÃ©es Solaires"
        },
        "options": {}
      },
      "id": "1e67a26a-09c6-49b8-b9a1-9055458b81fa",
      "name": "Appel SUB Sunrise-Sunset",
      "type": "n8n-nodes-base.executeWorkflow",
      "position": [
        736,
        400
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "r7fhudUyDIqwqXUC",
          "mode": "list",
          "cachedResultName": "solar_data",
          "cachedResultUrl": "/projects/HmXlcweiu5I7NsBE/datatables/r7fhudUyDIqwqXUC"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $json.timestamp }}",
            "date": "={{ $json.date }}",
            "sunrise": "={{ $json.sunrise }}",
            "sunset": "={{ $json.sunset }}",
            "solar_noon": "={{ $json.solar_noon }}",
            "day_length": "={{ $json.day_length }}",
            "civil_twilight_begin": "={{ $json.civil_twilight_begin }}",
            "civil_twilight_end": "={{ $json.civil_twilight_end }}",
            "nautical_twilight_begin": "={{ $json.nautical_twilight_begin }}",
            "nautical_twilight_end": "={{ $json.nautical_twilight_end }}",
            "astronomical_twilight_begin": "={{ $json.astronomical_twilight_begin }}",
            "astronomical_twilight_end": "={{ $json.astronomical_twilight_end }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "sunrise",
              "displayName": "sunrise",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "sunset",
              "displayName": "sunset",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "solar_noon",
              "displayName": "solar_noon",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "day_length",
              "displayName": "day_length",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "civil_twilight_begin",
              "displayName": "civil_twilight_begin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "civil_twilight_end",
              "displayName": "civil_twilight_end",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "nautical_twilight_begin",
              "displayName": "nautical_twilight_begin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "nautical_twilight_end",
              "displayName": "nautical_twilight_end",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "astronomical_twilight_begin",
              "displayName": "astronomical_twilight_begin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "astronomical_twilight_end",
              "displayName": "astronomical_twilight_end",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "1ee87c3f-8870-4ff7-acc1-1bb527f2b37a",
      "name": "Ã‰criture Data Table Solar",
      "type": "n8n-nodes-base.dataTable",
      "position": [
        976,
        400
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 1 * * *"
            }
          ]
        }
      },
      "id": "e533dc9b-e2c5-4f3b-ba66-85bc706c63c8",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        240,
        400
      ],
      "typeVersion": 1.2,
      "notes": "â° CRON: 01h00 Paris (heure d'hiver UTC+1)\nâš ï¸VÃ©rifier si cela fonctionne bien en Ã©tÃ©"
    },
    {
      "parameters": {
        "operation": "deleteRows",
        "dataTableId": {
          "__rl": true,
          "value": "r7fhudUyDIqwqXUC",
          "mode": "list",
          "cachedResultName": "solar_data",
          "cachedResultUrl": "/projects/HmXlcweiu5I7NsBE/datatables/r7fhudUyDIqwqXUC"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "timestamp",
              "condition": "lt",
              "keyValue": "={{ new Date(Date.now() - 48 * 60 * 60 * 1000).toISOString() }}"
            }
          ]
        },
        "options": {}
      },
      "id": "30af5c7d-5a42-4b90-b350-82a2dc9dba06",
      "name": "Purge Solar > 48h",
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1232,
        400
      ],
      "notes": "ðŸ—‘ï¸ Purge Solar > 48h\nSupprime automatiquement anciennes entrÃ©es\nâœ… Calcul dynamique du timestamp (maintenant - 48h)"
    }
  ],
  "pinData": {},
  "connections": {
    "PrÃ©paration Date/Heure": {
      "main": [
        [
          {
            "node": "Appel SUB Sunrise-Sunset",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Appel SUB Sunrise-Sunset": {
      "main": [
        [
          {
            "node": "Ã‰criture Data Table Solar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "PrÃ©paration Date/Heure",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ã‰criture Data Table Solar": {
      "main": [
        [
          {
            "node": "Purge Solar > 48h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "timezone": "Europe/Paris"
  },
  "versionId": "bfbd0ed4-2333-47bf-aeba-c315900a6f2a",
  "meta": {
    "instanceId": "2194913e407b1e503ee1051e748fa0b50f28c847d89d91263b2430bdb12da207"
  },
  "id": "J1o613yJmGZxSSzR",
  "tags": []
}