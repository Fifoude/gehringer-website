{
  "name": "[SUB] Forecast.Solar - PrÃ©vision Jour",
  "nodes": [
    {
      "parameters": {},
      "id": "uuid-trigger",
      "name": "Appel depuis workflow parent",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        240,
        304
      ],
      "typeVersion": 1,
      "notes": "ðŸ”” Trigger SUB-workflow\nAppelÃ© par: Workflow B (temps rÃ©el)"
    },
    {
      "parameters": {
        "jsCode": "// Configuration centralisÃ©e\nconst SOLAR_CONFIG = {\n  latitude: 48.8782753,\n  longitude: 2.2268011,\n  declination: 5,\n  azimuth: 44,\n  power: 3.36,\n  timezone: 'Europe/Paris',\n  location: 'Suresnes, France'\n};\n\n// RÃ©cupÃ©rer la date demandÃ©e (si fournie par le parent)\nconst input = $input.first().json;\nconst requestedDate = input.date || new Date().toISOString().split('T')[0];\n\n// Construire l'URL forecast.solar pour prÃ©vision par jour\n// Format: /estimate/watthours/day/{lat}/{lon}/{dec}/{az}/{kwp}?time=YYYY-MM-DDTHH:MM:SS+TZ\nconst timeParam = `${requestedDate}T00:00:00+00:00`;\nconst url = `https://api.forecast.solar/estimate/watthours/day/${SOLAR_CONFIG.latitude}/${SOLAR_CONFIG.longitude}/${SOLAR_CONFIG.declination}/${SOLAR_CONFIG.azimuth}/${SOLAR_CONFIG.power}?time=${encodeURIComponent(timeParam)}`;\n\nreturn [{\n  json: {\n    solarConfig: SOLAR_CONFIG,\n    requestedDate: requestedDate,\n    url: url\n  }\n}];"
      },
      "id": "uuid-config",
      "name": "Configuration",
      "type": "n8n-nodes-base.code",
      "position": [
        464,
        304
      ],
      "typeVersion": 2,
      "notes": "âš™ï¸ Config Forecast.Solar - PrÃ©visions PAR JOUR\nðŸ“… Input: date (YYYY-MM-DD) ou aujourd'hui\nðŸ”Ž API: /estimate/watthours/day (total journalier)"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {
          "timeout": 10000
        }
      },
      "id": "uuid-http",
      "name": "RequÃªte Forecast Solar",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        688,
        304
      ],
      "typeVersion": 4.2,
      "notes": "ðŸŒ RequÃªte Forecast.Solar API\nTimeout: 10s | Retourne prÃ©vision totale par jour"
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nconst config = $('Configuration').item.json;\n\n// VÃ©rifier la rÃ©ponse API\nif (response.message && response.message.code !== 0) {\n  throw new Error(`Erreur Forecast.Solar (code ${response.message.code}): ${response.message.text || 'Erreur inconnue'}`);\n}\n\n// Extraire les prÃ©visions par jour\nconst result = response.result || {};\n\n// Convertir en tableau pour faciliter le traitement\nconst forecasts = Object.entries(result).map(([date, watthours]) => ({\n  date: date,\n  forecast_wh: parseFloat(watthours),\n  forecast_kwh: parseFloat((watthours / 1000).toFixed(3))\n}));\n\n// Convertir en timezone Europe/Paris\nconst timestamp = new Date().toLocaleString('sv-SE', { timeZone: 'Europe/Paris' }).replace(' ', 'T');\n\nconst output = {\n  timestamp: timestamp,\n  requestedDate: config.requestedDate,\n  forecasts: forecasts,\n  metadata: {\n    source: 'forecast.solar',\n    apiInfo: response.message || {},\n    timezone: config.solarConfig.timezone,\n    location: config.solarConfig.location\n  }\n};\n\nreturn [{ json: output }];"
      },
      "id": "uuid-format",
      "name": "Formatage DonnÃ©es",
      "type": "n8n-nodes-base.code",
      "position": [
        912,
        304
      ],
      "typeVersion": 2,
      "notes": "ðŸ“¦ Formatage rÃ©ponse:\n1. VÃ©rifie code API = 0\n2. Convertit {date: wh} en tableau forecasts[]\n3. Ajoute date, kwh\nðŸ“Š Valeur = production totale attendue pour la journÃ©e"
    }
  ],
  "pinData": {},
  "connections": {
    "Appel depuis workflow parent": {
      "main": [
        [
          {
            "node": "Configuration",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Configuration": {
      "main": [
        [
          {
            "node": "RequÃªte Forecast Solar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RequÃªte Forecast Solar": {
      "main": [
        [
          {
            "node": "Formatage DonnÃ©es",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "timezone": "Europe/Paris"
  },
  "versionId": "341c3527-f8fd-45ac-9430-2c0ee0db6cfe",
  "meta": {
    "instanceId": "2194913e407b1e503ee1051e748fa0b50f28c847d89d91263b2430bdb12da207"
  },
  "id": "O2kp4R4akvxZdBZW",
  "tags": []
}