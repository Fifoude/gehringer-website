{
    "name": "Ingestion RAG - CSV Expériences (Senior) v2",
    "nodes": [
        {
            "parameters": {
                "formTitle": "Upload Expériences (CDI & Missions)",
                "formDescription": "Uploader le fichier data_ingestion_template.csv.",
                "formFields": {
                    "values": [
                        {
                            "fieldLabel": "Fichier CSV",
                            "fieldType": "file",
                            "acceptFileTypes": ".csv",
                            "requiredField": true
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.formTrigger",
            "typeVersion": 2.2,
            "position": [
                0,
                0
            ],
            "id": "trigger-upload",
            "name": "Upload CSV"
        },
        {
            "parameters": {
                "options": {}
            },
            "type": "n8n-nodes-base.spreadsheetFile",
            "typeVersion": 2,
            "position": [
                220,
                0
            ],
            "id": "parse-csv",
            "name": "Parse CSV"
        },
        {
            "parameters": {
                "jsCode": "// Transformation Intelligente pour Profil Manager de Transition\nreturn items.map(item => {\n  const row = item.json;\n  let narrativeContext = \"\";\n  if (row.Type_Contrat && row.Type_Contrat.toLowerCase().includes('mission')) {\n     narrativeContext = \"INTERVENTION COMMANDO / TRANSITION : Mission focalisée sur des résultats rapides.\";\n  } else {\n     narrativeContext = \"EXPÉRIENCE DE FOND (CDI/MANDAT) : Gestion dans la durée, vision stratégique et stabilité.\";\n  }\n  const pageContent = `\n    ${narrativeContext}\n    Rôle: ${row.Role_Titre}\n    Cadre: ${row.Entreprise_Ou_Client} (${row.Secteur})\n    Durée: ${row.Date_Debut} à ${row.Date_Fin}\n    SITUATION INITIALE: ${row.Situation_Initiale}\n    TRANSFORMATIONS: ${row.Actions_Et_Transformations}\n    RÉSULTATS: ${row.Resultats_Impact}\n    Expertises: ${row.Competences_Cles}\n    Outils: ${row.Outils_Techno}\n  `.trim();\n  return {\n    json: {\n      ...row,\n      pageContent,\n      is_transition: row.Type_Contrat && row.Type_Contrat.toLowerCase().includes('mission')\n    }\n  };\n});"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                440,
                0
            ],
            "id": "format-content",
            "name": "Formatage Senior RAG"
        },
        {
            "parameters": {
                "mode": "insert",
                "qdrantCollection": {
                    "__rl": true,
                    "value": "experience_pro",
                    "mode": "list",
                    "cachedResultName": "experience_pro"
                },
                "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
            "typeVersion": 1,
            "position": [
                880,
                0
            ],
            "id": "qdrant-store",
            "name": "Qdrant Vector Store"
        },
        {
            "parameters": {
                "model": "embeddinggemma:latest"
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOllama",
            "typeVersion": 1,
            "position": [
                860,
                240
            ],
            "id": "ollama-model",
            "name": "Embeddings Ollama"
        },
        {
            "parameters": {
                "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
            "typeVersion": 1,
            "position": [
                640,
                240
            ],
            "id": "data-loader",
            "name": "Data Loader"
        },
        {
            "parameters": {
                "chunkSize": 2000,
                "chunkOverlap": 100
            },
            "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
            "typeVersion": 1,
            "position": [
                480,
                360
            ],
            "id": "text-splitter",
            "name": "Recursive Character Text Splitter"
        }
    ],
    "connections": {
        "Upload CSV": {
            "main": [
                [
                    {
                        "node": "Parse CSV",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Parse CSV": {
            "main": [
                [
                    {
                        "node": "Formatage Senior RAG",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Formatage Senior RAG": {
            "main": [
                [
                    {
                        "node": "Qdrant Vector Store",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Embeddings Ollama": {
            "ai_embedding": [
                [
                    {
                        "node": "Qdrant Vector Store",
                        "type": "ai_embedding",
                        "index": 0
                    }
                ]
            ]
        },
        "Data Loader": {
            "ai_document": [
                [
                    {
                        "node": "Qdrant Vector Store",
                        "type": "ai_document",
                        "index": 0
                    }
                ]
            ]
        },
        "Recursive Character Text Splitter": {
            "ai_textSplitter": [
                [
                    {
                        "node": "Data Loader",
                        "type": "ai_textSplitter",
                        "index": 0
                    }
                ]
            ]
        }
    }
}